<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <input type="text" id="input" placeholder="New ToDo" />
    <button id="button" onclick="addToDo()" disabled>Add</button>
    <ul id="list"></ul>

    <script>
      class ToDo {
        constructor(text) {
          this._completed = false;
          this._text = text;
        }
        get completed() {
          return this._completed;
        }
        get text() {
          return this._text;
        }
        complete() {
          this._completed = true;
        }
      }
      class ToDoList {
        constructor() {
          this._toDos = [];
        }
        get toDos() {
          return [...this._toDos];
        }
        createToDo(text) {
          const toDo = new ToDo(text);
          this._toDos.push(toDo);
          return toDo;
        }
        deleteToDo(toDo) {
          this._toDos = this._toDos.filter((a) => a !== toDo);
        }
        setMemento(toDosMemento) {
          toDosMemento.forEach((a) => {
            const toDo = new ToDo(a.text);
            if (a.completed) toDo.complete();
            this._toDos.push(toDo);
          });
        }
        getMemento() {
          return this._toDos.map((a) => ({
            completed: a.completed,
            text: a.text,
          }));
        }
      }

      const toDosFromSession = sessionStorage.getItem("listOfTodos");
      const toDosBackup =
        toDosFromSession !== null ? JSON.parse(toDosFromSession) : [];
      const toDoList = new ToDoList();
      toDoList.setMemento(toDosBackup);

      function startApp() {
        renderList();
        attachEvents();
      }

      function attachEvents() {
        const buttonElement = document.getElementById("button");
        const inputElement = document.getElementById("input");
        inputElement.oninput = (ev) => {
          buttonElement.disabled = !Boolean(ev.target.value);
        };
        inputElement.onkeypress = (ev) => {
          if (ev.target.value && ev.key === "Enter") addToDo();
        };
      }

      function addToDo() {
        const inputElement = document.getElementById("input");
        const value = inputElement.value;
        toDoList.createToDo(value);
        inputElement.value = "";
        renderList();
        saveMemento();
      }

      function createToDoElement(toDo) {
        // Checkbox completed
        const checkboxElement = document.createElement("input");
        checkboxElement.checked = toDo.completed;
        checkboxElement.disabled = toDo.completed;
        checkboxElement.onclick = () => {
          toDo.complete();
          renderList();
          saveMemento();
        };
        checkboxElement.type = "checkbox";
        // Text element
        const textElement = document.createElement("span");
        textElement.innerText = toDo.text;
        if (toDo.completed) textElement.style.textDecoration = "line-through";
        // Remove button
        const removeElement = document.createElement("button");
        removeElement.innerText = "x";
        removeElement.onclick = () => {
          toDoList.deleteToDo(toDo);
          renderList();
          saveMemento();
        };
        // ToDo Element
        const toDoElement = document.createElement("li");
        toDoElement.appendChild(checkboxElement);
        toDoElement.appendChild(textElement);
        toDoElement.appendChild(removeElement);
        return toDoElement;
      }

      function renderList() {
        const liElements = toDoList.toDos.map(createToDoElement);
        const listElement = document.getElementById("list");
        listElement.replaceChildren(...liElements);
      }
      function saveMemento() {
        sessionStorage.setItem(
          "listOfTodos",
          JSON.stringify(toDoList.getMemento())
        );
      }

      startApp();
    </script>
  </body>
</html>
